<%#
  Custom select-like dropdown that shows icon + label for each option.
  Mirrors the native <select> appearance (border, rounded, chevron) while
  supporting inline SVG icons that native <option> elements cannot render.

  Locals:
    name        – form field name (e.g. "admin[theme]")
    value       – currently selected value
    options     – array of { value:, label:, icon_name: } hashes
    label_text  – the field label text
    id          – optional wrapper HTML id
    required    – whether to show the required asterisk (default: false)
    wrapper_class – optional extra CSS classes on the outer wrapper
-%>
<% selected = options.find { |o| o[:value] == value } || options.first %>

<div
  data-controller="icon-select"
  data-action="click@document->icon-select#closeOnClickOutside keydown.esc@document->icon-select#close"
  <% if local_assigns[:id] %>
    id="<%= id %>"
  <% end %>
  <% if local_assigns[:wrapper_class] %>
    class="<%= wrapper_class %>"
  <% end %>
>
  <label>
    <%= label_text %>

    <% if local_assigns[:required] && required %>
      <abbr title="required">*</abbr>
    <% end %>
  </label>

  <input
    type="hidden"
    name="<%= name %>"
    value="<%= value %>"
    data-icon-select-target="input"
  >

  <div class="relative mt-1">
    <button
      type="button"
      data-icon-select-target="button"
      data-action="icon-select#toggle"
      class="
        select-chevron flex w-full cursor-pointer items-center rounded-md
        border border-gray-300 bg-gray-50 p-2 px-3 text-left text-base
        text-gray-900 focus:z-10 focus:border-green-500 focus:shadow-none
        focus:ring-1 focus:ring-green-500 focus:ring-offset-0
        focus:outline-hidden dark:border-gray-600 dark:bg-gray-800
        dark:text-white focus:dark:border-green-600
        focus:dark:ring-green-600
      "
    >
      <span class="inline-flex items-center gap-2">
        <span data-icon-select-target="iconSlot">
          <%= icon(selected[:icon_name], class: "size-4") %>
        </span>

        <span data-icon-select-target="label"><%= selected[:label] %></span>
      </span>
    </button>

    <ul
      data-icon-select-target="dropdown"
      class="
        absolute z-50 mt-1 hidden w-full overflow-auto rounded-md border
        border-gray-200 bg-white shadow-lg dark:border-gray-600
        dark:bg-gray-800
      "
    >
      <% options.each do |opt| %>
        <li
          data-action="click->icon-select#select"
          data-value="<%= opt[:value] %>"
          data-label="<%= opt[:label] %>"
          data-icon-name="<%= opt[:icon_name] %>"
          class="flex cursor-pointer items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 <%= "bg-gray-100 dark:bg-gray-700" if opt[:value] == value %>"
        >
          <%= icon(opt[:icon_name], class: "size-4") %>
          <span><%= opt[:label] %></span>
        </li>
      <% end %>
    </ul>
  </div>
</div>
